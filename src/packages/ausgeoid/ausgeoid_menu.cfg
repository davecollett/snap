

function AddGeoidHeights()
    if not CheckCoordinateFile(true) then exit endif
    $relname = Filename($coordinate_file,"relative",$job_path)
    $geoid = "nzgeoid09"

    $geoidlist= "~nzgeoid09~New Zealand Geoid 2009"
    $geoidlist= $geoidlist."~egm96~EGM96"
    $geoidlist=$geoidlist."~ausgeoid09_v101.grd~AUSGeoid09 v1.01"
    
    dialog "Add geoid heights and deflections"
       label "Add geoid heights and deflections to the station file"
       label "Coordinate file: $relname"
       spacer
       radio_selector $geoid "Select the new geoid to use" $geoidlist
    end_dialog
    $backupfile = BackupCoordinateFile($coordinate_file)
    if not $backupfile then 
       message("Could not create backup file of $relname","Error")
       exit
    endif
   $output = debuglogrun("\"$snap_path/snapgeoid\" -c -g $geoid \"$backupfile\" \"$coordinate_file\"")
   log("\n$output\nGeoid heights added to $relname")
end_function
